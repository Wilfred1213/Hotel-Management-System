{% extends 'hotel/base/base.html' %}

{% block title %}Home Page{% endblock %}


{% block content %}
<!-- Your existing template content -->

<div class="col-md-4 text-center">
    <form id="payment-form">
        {% csrf_token %}
        <div class="form-group">
            <label for="card-element">Credit or debit card</label>
            <div id="card-element">
                <!-- A Stripe Element will be inserted here. -->
            </div>
        </div>
        <div id="card-errors" role="alert"></div>
        <button type="submit" class="btn btn-success">Pay Now</button>
    </form>
</div>

<script src="https://js.stripe.com/v3/"></script>
<script>
    var stripe = Stripe('{{ settings.STRIPE_PUBLISHABLE_KEY }}');
    var elements = stripe.elements();
    var card = elements.create('card');
    card.mount('#card-element');

    var form = document.getElementById('payment-form');
    form.addEventListener('submit', function (event) {
        event.preventDefault();
        stripe.createPaymentMethod({
            type: 'card',
            card: card,
        }).then(function (result) {
            if (result.error) {
                // Display errors to the user
                var errorElement = document.getElementById('card-errors');
                errorElement.textContent = result.error.message;
            } else {
                // Send the payment method ID to your server
                fetch('{% url "create_payment_intent" %}', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': '{{ csrf_token }}',
                    },
                    body: JSON.stringify({ 'amount': 1000 }), // Replace 1000 with your actual payment amount in cents
                }).then(function (response) {
                    return response.json();
                }).then(function (data) {
                    if (data.client_secret) {
                        // Create a payment confirmation
                        stripe.confirmCardPayment(data.client_secret, {
                            payment_method: result.paymentMethod.id,
                        }).then(function (result) {
                            if (result.error) {
                                // Payment failed, handle the error
                                alert(result.error.message);
                            } else {
                                // Payment succeeded, show a success message or redirect to a success page
                                alert('Payment succeeded!');
                            }
                        });
                    } else if (data.error) {
                        // Handle the error returned from the server
                        alert(data.error);
                    }
                });
            }
        });
    });
</script>

<!-- Rest of the template content -->

{% endblock %}
